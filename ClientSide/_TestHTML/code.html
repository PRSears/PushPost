<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
	<title>PatrickSears.ca</title>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:300' rel='stylesheet' type='text/css'>
	<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js?skin=sons-of-obsidian"></script>
	<link rel="stylesheet" type="text/css" href="css/styles.css"/>
</head>

<body>

	<div id="navigation-bar">
		<div id="header-center">
			<div id="logo-image"> </div>
			<div id="navigation-links">
				<a href="gallery.html">PHOTOGRAPHY</a><a class="spacer">+</a><a href="code.html" class="current">CODE</a><a class="spacer">+</a><a href="index.html">CONTACT</a>
			</div>
		</div>
	</div>
	
	<div id="primary-column">
		<h1>Source code and binary downloads</h1>
		<p>This is primarily a backup for a couple projects, with some accompanying thoughts to help me keep it straight in my head.</p>
				
		<h1 headers="post-title">
			TestPost Alpha
		</h1>
		<p>This is a test of automatic text post generation.</p>
		<p>This should be in a new paragraph.</p>
		<p>This third paragraph should include markup for Test.jpg. </p>
		<img src="C:/Not/A/Real/Path/Test.jpg">
		<p class="footer">Post footer would normally contain download links to things mentioned in the post, or perhaps the <a href="https://www.google.ca/search?q=what+time+is+it">date</a>.</p>

<!-- ********* End of post: TestPost Alpha ********* -->




		<h1 headers="PostTitle">PxRT</h1>
		<img src="http://psears.web.s3.amazonaws.com/code/pxRT.png">
		<p>A simple project to play with an interesting bit of image manipulation. </p>
		<p>It sorts the pixels of an image, either in each row or in each column. There's also an option for controlling the brightness threshold. Once a pixel is found crossing the threshold the sorting stops for that row.</p>
		<pre class="prettyprint linenums:21"><code>
public static void SortVerticals(PixelWrapper Image)
{
	List<Pixel> Unsorted = Image.GetPixels();
	Pixel[] Sorted = new Pixel[Unsorted.Count];

	for (int x = 0; x < Image.Width; x++)
	{
		List<Pixel> Col = new List<Pixel>();
		// Split out vertical column
		for (int y = 0; y < Image.Height; y++)
		{
			Col.Add(Unsorted[(y * Image.Width) + x]);
		}
		Col.Sort();

		// Reconstruct 
		for (int y = 0; y < Col.Count; y++)
		{
			Sorted[(y * Image.Width) + x] = Col[y];
		}
	}

	Image.SetPixels(Sorted.ToList());
}
		</code></pre>
		<p>This takes the list of Pixels from the image, moves down the y-axis adding each pixel into a new list, sorts it, and adds them into the Sorted array. Once the column is filled it moves forward along the x-axis to the next column.</p>
		<p>The Pixel list works by unravelling the rows of an image. Each horizontal row of pixels follows the previous in one long line. </p>
		<p>This excerpt doesn't take the threshold into account.</p>		
		<p class="footer">Download source <a href="http://psears.web.s3.amazonaws.com/code/PxRT%20Source%202013-11-03.rar">[2013-11-03]</a></p>
		<p class="footer">Download binary <a href="http://psears.web.s3.amazonaws.com/code/PxRT%201.0.2.zip">[1.0.2]</a></p>
		
		<h1>CBA Exporter</h1>
		<img src="http://psears.web.s3.amazonaws.com/code/CBA.png">
		<p>This is a program written for Geokinetics to manage the battery test results. A batch of batteries would be put under a 6A load, and <a href="http://www.westmountainradio.com/cba.php">the Computer Battery Analyzer</a> software would generate XML files of the raw data. My exporter takes the relevant data from each XML file, formats it, and inserts it into a single Excel spreadsheet to manage the entire inventory. </p>
		<p>The Append method below is the heart of the Inventory class which works with the Microsoft Office Interoperability library.
		<pre class="prettyprint linenums:39"><code>
public void Append(BatteryResult newResult)
{
	int bottom = NextRow("B") + 2; // The row number for where we want to start appending new data

	//HACK force text formating on B column each time data is appended. 
	//Excel was, on certain entries, changing the formating to unpredictable styles.
	SetCellFormat("@", "B5", "B" + bottom);

	EditCell("B" + bottom, newResult.TestName);
	EditCell("C" + bottom, newResult.InitialVoltage.ToString());
	EditCell("D" + bottom, newResult.TestedCapacity.ToString(), ((newResult.TestedCapacity > 52) ? Color.DarkOliveGreen : Color.DarkRed));
	EditCell("G" + bottom, newResult.TestDate.ToShortDateString());
	EditCell("H" + bottom, "=CONCATENATE([@[Bat Serial '#]],\" - AH \",ROUND([@[Tested Capacity (AH)]], 2))"); // formula for scan bar
	if (newResult.Note != null) EditCell("I" + bottom, newResult.Note);
}
		</code></pre>
		<p class="footer">Download source <a href="http://psears.web.s3.amazonaws.com/code/CBAResultsExporter%201.1.3.1%20Source.rar">[v1.1.3]</a></p>
		<p class="footer">Download installer <a href="http://psears.web.s3.amazonaws.com/code/CBA%20Exporter%201.1.3%20Installer.zip">[v1.1.3]</a></p>
		
		<h1>AutoHotkey Script Manager</h1>
		<p>I usually have 3-4 different <a href="http://www.autohotkey.com/">AutoHotkey</a> scripts running at any given time. This leaves a mess of identical icons in the system tray, making it annoying to start and stop specific scripts. </p>
		<p>Which is where this script comes in. One script to rule them all. I can now hide all other scripts' tray icons (using the #NoTrayIcon command) and launch them through AhkManager. </p>
		<img src="http://psears.web.s3.amazonaws.com/code/AhkManager01.png">
		<p>Scripts can be loaded via command line parameters, or manually by editing the 'ChildList' section of the script. The manager makes it easier to stop and start specific scripts without having to sort through a grid of identical icons, or open the task manager.</p>
		<pre class="prettyprint linenums:13"><code>
; ---------------- # Add Child Scripts to launch with this one # --------------- ;   
;
; Child scripts must be in the same directory as Hotkeys.ahk!
; Use the name of the script (cannot contain spaces) without the extension
; Recommend adding '#NoTrayIcon' and '#SingleInstance force' to child scripts
;
; Child scripts can also be added as parameters when launching the script.
; Follow the same format.
; ------------------------------------------------------------------------------ ;
;ChildList.Insert("NameOfTheScript") ; Template
; -------------------------------End Child Scripts------------------------------ ;

gosub Init
Loop
{
	gosub RefreshTrayMenu
	Sleep, 1000
}
 
Init:
	; Load scripts from cmd arguments
	Loop, %0%  ; number or arguments
	{
		arg := %A_Index% 
		ChildList.Insert(arg)
	}

	CurrentChildren := Object()
	for index, element in ChildList ; shallow copy ChildList
	{
		CurrentChildren.Insert(element)
	}
	gosub LaunchChildScripts
return
 
LaunchChildScripts:
	for index, element in ChildList
	{
		LaunchChildByName(element)
	}
return

; Creates a new instance of a script
; name : the name of the script without path or extension
LaunchChildByName(name)
{
	Path := % name . ".ahk"
	Run, %Path%
	return
}

CloseChildLabel:
	i := A_ThisMenuItemPos
	CloseChildByName(RemoveElement(ChildList[i], CurrentChildren))	
return

StartChildLabel:
	i := A_ThisMenuItemPos
	LaunchChildByName(ChildList[i])
	if not InList(ChildList[i], CurrentChildren)
		CurrentChildren.Insert(ChildList[i])
return

CloseChildByName(name)
{
	DetectHiddenWindows, On
	Path := % A_ScriptDir . "\" . name . ".ahk"
	IfWinExist, %Path% ahk_class AutoHotkey
	{
		WinClose
	}
	gosub RefreshTrayMenu
	return
}

RefreshTrayMenu:
	tiptext = %TitleText%
	for i, e in CurrentChildren
		tiptext = %tiptext%`n  %e%
	
	Menu, Tray, Tip, %tiptext%

	Menu, Tray, NoStandard
	Menu, Tray, DeleteAll
	
	for index, element in ChildList
	{
		if not InList(element, CurrentChildren)
		{
			Menu, Tray, Add, % "Start " . element, StartChildLabel
		}
		else
		{
			Menu, Tray, Add, % "Stop " . element, CloseChildLabel
		}
	}
	
	Menu, Tray, Add
	Menu, Tray, Add, Restart all, Init
	Menu, Tray, Add, Exit %TitleText%, CloseAll
return
		</code></pre>
		<p>For the complete script (the above will not run on its own!) check the link below.<p>
		<p class="footer">Download source <a href="http://psears.web.s3.amazonaws.com/code/AHKManager.ahk">[AhkManager]</a></p>
		
		<h1>Cards Prototype</h1>
		<p>I started working on this when a friend was disappointed by the lack of flexibility with the official game. It's still far from finished, but the UI and graphics rendering are largely complete.</p>
		<p>This project uses C# and XNA, which may not have been for the best given its abandonment by Microsoft.</p>
		<img src="http://psears.web.s3.amazonaws.com/code/Pokecards_MainMenu.png">
		<pre class="prettyprint linenums:50"><code language="c#">
public override void Initialize()
	{
		interfaceSpriteBatch = new SpriteBatch(currentGame.GraphicsDevice);
		finalSpriteBatch = new SpriteBatch(currentGame.GraphicsDevice);

		StartServerButton = new Button(currentGame, asset: "StartServerButton");
		JoinGameButton = new Button(currentGame, asset: "JoinGameButton");
		EditDecksButton = new Button(currentGame, asset: "EditDecksButton");
		OptionsButton = new Button(currentGame, asset: "OptionsButton");

		// Add buttons to layout manager
		LayoutManager.AddElement(StartServerButton);
		LayoutManager.AddElement(JoinGameButton);
		LayoutManager.AddElement(EditDecksButton);
		LayoutManager.AddElement(OptionsButton);
		
		OnScreenElements = new List<IClickable>();
		// Add elements from all layout containers to OnScreenElements
		foreach (IClickable element in LayoutManager.Elements)
			OnScreenElements.Add(element);

		currentInputEvent = InputEvent.None;
		keyboardHandler = new KeyboardHandler(currentGame);
	}
		</code></pre>
		<p><strike>Magic numbers abound! I've been planning to put together a fluid layour manager, but I've been putting it off until I get the client/server relationship working. </strike></p>
		<p>Fluid layout manager functioning! The code below calculates element positions for a top-left floating layout.</p>
		<pre class="prettyprint linenums:65"><code>
private void PositionLeft()
{
	Rectangle prevElementPos = this.Position;
	prevElementPos.X += Margin;
	prevElementPos.Width -= Margin;
	prevElementPos.Height = 0;

	// The right-most (x) coordinate filled by a positioned element.
	// Used to track where the next column should start.
	int rightPoint = 0; 

	foreach (IClickable element in Elements)
	{
		// Check if we've reached the bottom of the container
		if ((element.HitBox.Height + prevElementPos.Bottom + (Margin*2)) > this.Position.Bottom)
		{
			// Make sure there's enough horizontal space left
			if ((element.HitBox.Width + rightPoint + Margin) > this.Position.Right)
				break;
			
			prevElementPos = this.Position; // reset position
			prevElementPos.X += rightPoint + Margin; // move into next column
			prevElementPos.Height = 0;
		}

		// Add the next element in-line below the last element
		element.Position = new Vector2(
			prevElementPos.X,
			prevElementPos.Y + prevElementPos.Height + Margin);
		// Track the right-most point a positioned element occupies
		if (element.HitBox.Right > rightPoint) rightPoint = element.HitBox.Right;    

		prevElementPos = element.HitBox;
	}
}
		</code></pre>
		<img src="http://psears.web.s3.amazonaws.com/code/FluidLayoutTestScreen.png">		
		<p class="footer">Download source <a href="http://psears.web.s3.amazonaws.com/code/Cards_Source_Archive_2013-10-24.rar" target="_blank">[alpha 2013.10.24]</a></p>
		<p class="footer"><a href="https://www.assembla.com/code/psears_cards/subversion/nodes/14/trunk" target="_blank">Browse SVN</a></p>
		
		<h1>PalinPrime</h1>
		<p> This was a problem posted to reddit from a job application's website. The goal was to find the first 7 digit number from within Pi that was both a prime number and a palindrome. It's a fun little problem, but I cheated a bit by loading a pre-calculated value of Pi into memory first.</p>
		<pre class="prettyprint linenums"><code>
class FindPalinPrime
{
	static void Main(string[] args)
	{            
		String pi = File.ReadAllText(@"pi.txt"); //cheating a bit

		int i = 1;
		while (i < pi.Length)
		{
			// the initial problem specified the first 7 digit prime palindrome within Pi
			int subPi = int.Parse(pi.Substring(i++, 7)); 
			if (isPalindrome(subPi))
			{
				if (isPrime(subPi))
				{
					Console.WriteLine("PalinPrime found @" + i);
					Console.WriteLine(subPi);
					break;
				}
			}
		}
		
		Console.ReadKey();
	}

	// we can use a (relatively) slow algorithm for prime checking because it's only
	// checking when a palindrome appears 
	public static Boolean isPrime(int n)
	{
		for (int divisor = 2; divisor <= (Math.Sqrt(n)); divisor++)
			if ((n % divisor) == 0) return false;
		return true;
	}

	public static int reverse(int n)
	{
		int result = 0;
		while ((n / 10) > 0) // break once n has only one digit
		{
			// shift the result one decimal place left, add the last digit from n
			// the result of n % 10 is always the same as the last digit of n
			result = (result * 10) + (n % 10);
			n /= 10; 
		}
		result = (result * 10) + (n % 10); // take the final digit
		return result;
	}

	public static Boolean isPalindrome(int n)
	{
		if (reverse(n) == n)
			return true;
		return false;
	}
}
		</code></pre>
	</div>

</body>
</html>